<!DOCTYPE html>
<html lang="zn-CN">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ulab数据管理平台</title>
    <link rel="stylesheet" href="${contextPath}/static/admin/css/bootstrap.min-3.3.7-blue.css">
    <link rel="stylesheet" href="${contextPath}/static/admin/css/style.css">
    <style>
        .table td.opt {
            text-align: left;
        }

        td.opt .btn {
            padding-top: 0;
            padding-bottom: 0;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="${contextPath}/admin/mapList" class="navbar-brand">Ulab数据管理平台</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="${contextPath}/admin/mapList"><span class="glyphicon glyphicon-home"></span>平面地图数据</a></li>
                <li><a href="${contextPath}/admin/labInfoList"><span class="glyphicon glyphicon-home"></span>实验室明细</a>
                </li>
                <li><a href="${contextPath}/admin/userList"><span class="glyphicon glyphicon-home"></span>账号管理</a></li>
                <li class="active"><a href="${contextPath}/admin/orderList"><span
                    class="glyphicon glyphicon-home"></span>实验室订单</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a class=" dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="true">
                        当前用户：${user.name!}
                    </a>
                </li>
                <li onclick="logout()"><a href="javascript:void(0);"><span class="glyphicon glyphicon-off"></span>退出</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<!--导航-->

<div class="container-fluid" id="otherDataList">
    <div class="row">
        <div class="col-md-12">
            <div class="page-header">
                <h2>实验室订单</h2>
            </div>
            <div class=" table-responsive">
                <table class="table table-condensed table-bordered table-striped table-hover">
                    <thead>
                    <tr>
                        <th>id</th>
                        <th>页面id</th>
                        <th>名称</th>
                        <th>内容</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="(item,index) in curItemList">
                        <td>{{item.id}}</td>
                        <td>{{item.pageId}}</td>
                        <td>{{item.name}}</td>
                        <td>{{item.content}}</td>
                        <td class="opt">
                            <button class="btn btn-primary btn-sm btn-edit" @click="updateItem(item)">编辑</button>
                            <br>
                            <button class="btn btn-danger btn-sm btn-del" @click="delItem(item.id)">删除</button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <nav aria-label="Page navigation">
                <ul class="pagination pull-right pagination-ul">
                    <li><a href="javascript:void(0)" @click="changePage()" aria-label="Previous"><span
                        aria-hidden="true">&laquo;</span> </a></li>
                    <li><a href="javascript:void(0)" style="pointer-events: none">{{pageCur}}/{{pageTotal}}</a></li>
                    <li><a href="javascript:void(0)" @click="changePage('next')" aria-label="Next"><span
                        aria-hidden="true">&raquo;</span> </a></li>
                </ul>
                <div class="pagination pull-right result">
                    查询结果：共
                    <output>{{filterItemList.length}}</output>
                    条
                </div>
            </nav>
        </div>
    </div>
</div>
<div id="bottom"></div>

<script src="${contextPath}/static/admin/js/jquery-2.2.4.js"></script>
<script src="${contextPath}/static/admin/js/bootstrap.js"></script>
<script src="${contextPath}/static/assets/js/vue-2.6.10.js"></script>
<script>
    let contextPath = '${contextPath!}';
    let VueOrderList = new Vue({
        el: '#orderList',
        data: {
            orderList: {
                header: {}, itemList: [],
            },
            orderListHeader: ['totalNum', 'underTest', 'toBeDistributed', 'testing', 'completed', 'completion'],
            curItemList: [],
            filterItemList: [],
            pageCur: 1,
            itemPerPage: 5,
            pageTotal: 0,
            keywords:'',

        },
        beforeMount() {
            this.getOrderList();
        },
        methods: {
            getOrderList() {
                // 查询接口
                $.get(contextPath + "/static/data/orderList.json", data => {
                    this.orderList = data;
                    this.filterItemList = this.orderList.itemList;
                    this.pagination();
                })
            },
            pagination() {
                let isInt = this.orderList.itemList.length % this.itemPerPage === 0;
                this.pageTotal = (this.filterItemList.length / this.itemPerPage + (isInt ? 0 : 1)) | 0;
                this.curItemList = this.filterItemList.slice((this.pageCur - 1) * this.itemPerPage, (this.pageCur) * this.itemPerPage)
            },
            changePage(next) {
                if (next) {
                    if (this.pageCur === this.pageTotal) return false;
                    this.pageCur++
                } else {
                    if (this.pageCur === 1) return false;
                    this.pageCur--
                }
                this.pagination()
            },
            search(){
                this.filterItemList = this.orderList.itemList.filter(item=>{
                    return Object.keys(item).some(k=>{
                        if(typeof item[k] === 'object'){
                            return Object.keys(item[k]).some(kk=>{
                                return item[k][kk].includes(this.keywords)
                            })
                        }else{
                            return item[k].includes(this.keywords)
                        }

                    })
                });
                this.pagination();
            },
            delItem(id){
                if(!confirm('确认删除？')){return}
                // 模拟删除，生产中请屏蔽
                this.orderList.itemList.splice(this.orderList.itemList.findIndex(item=>item.id===id),1);
                this.pagination();
                 // 删除接口
                $.get(contextPath+'/admin/delOrderInfo?id='+id, data => {
                    if(data.result){
                        location.href='';
                    }
                })
            },
            addItem(){
                localStorage.setItem('updateItem','');
                location.href=contextPath+'/admin/orderForm';
            },
            updateItem(item){
                localStorage.setItem('updateItem',JSON.stringify(item));
                location.href=contextPath+'/admin/orderForm?id='+item.id;
            }
        }
    });
</script>
</body>
</html>