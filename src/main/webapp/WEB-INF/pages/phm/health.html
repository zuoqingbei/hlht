<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="PHM" content="phm二期" />
		<title>全球冰箱健康度</title>
		
		<link rel="stylesheet" href="${contextPath}/static/phm/css/common.css" />
		<link rel="stylesheet" href="${contextPath}/static/phm/css/health.css" />
	</head>
	<body>
		<div id="content">
			<!--head-->
			<div id="head">
				<h1>
					<a href="#">
						<img src="${contextPath}/static/phm/images/health/logo_haier_bold.png" alt="" />
					</a>
				</h1>
				<h2>基于物联网+大数据的用户最佳体验</h2>
			</div>
			<!--centerdata-->
			<div id="centerData">
				<div class="dataBox ml">
					<span>全部</span>
					<p id="total">686788</p>
				</div>
				<div class="dataBox">
					<span>冰箱</span>
					<p>686788</p>
				</div>
				<div class="dataBox">
					<span>商空</span>
					<p>686788</p>
				</div>
				<div class="dataBox">
					<span>洗衣机</span>
					<p>6788</p>
				</div>
				<div class="dataBox">
					<span>冷柜</span>
					<p>686788</p>
				</div>
				<div class="dataBox">
					<span>家空</span>
					<p>686788</p>
				</div>
			</div>
			<!--bottom-->
			<div id="bottom">
				<!--===============leftMod===================-->
				<div class="leftMod">
					<div class="picMod bxzxl">
						<h3>冰箱在线率</h3>
						<div class="echartsbox">
							<div id="bxzxl" style="height:100%;width:100%"></div>
						</div>
					</div>
					<div class="picMod jkd">
						<h3>健康度</h3>
						<div class="echartsbox">
							<div id="jkd" style="height:100%;width:100%"></div>
						</div>
					</div>
					<div class="picMod jkfb">
						<h3>健康分布</h3>
						<div class="echartsbox">
							<div id="jkfb" style="height:100%;width:100%"></div>
						</div>
					</div>
				</div>
				<!--===============centerMod===================-->
				<div class="centerMod">
					<div id="map" style="height: 100%;width: 100%;"></div>
				</div>
				<!--===============rightMod===================-->
				<div class="rightMod">
					<div class="leftpart">
						<div class="blcpqk">
							<h4>不良产品情况</h4>
							<div class="picBox">
								<div id="blcpqk" style="width:100%;height: 100%;"></div>
							</div>
						</div>
						<div class="jkddb">
							<h5>健康度对比</h5>
							<div class="picBox1">
								<div id="jkddb" style="width:100%;height: 100%;"></div>
							</div>
						</div>
					</div>
					<div class="rightpart">	
						<div class="zdyc">
							<h5>诊断预测</h5>
							<div class="picBox1">
								<div id="zdyc" style="width:100%;height: 100%;"></div>
							</div>
						</div>
						<div class="ydqk">
							<h5><a href="${contextPath}/fault/service" style="color:#fff">应对情况</a></h5>
							<div class="picBox1">
								<div id="ydqk" style="width:100%;height: 100%;"></div>
							</div>
						</div>
						<div class="zlqs">
							<h5>质量趋势</h5>
							<div class="picBox1">
								<div id="zlqs" style="width:100%;height: 100%;"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		
		<script src="${contextPath}/static/phm/asserts/js/jquery-2.2.4.js" type="text/javascript" charset="utf-8"></script>
		<script src="${contextPath}/static/phm/asserts/echarts/echarts-all-2.2.7.min.js" type="text/javascript" charset="utf-8"></script>
		<script>
				/*屏幕描述
				         一共 7x3 个屏幕，每一块屏幕是1360x768，
				         总共的大小就是9520x2304，比预计像素少7x6=42个像素。*/

				var pageH = $(window).height();
				var pageW = pageH * 16 * 7 / (9 * 3);
				var bodyScale = pageH / 595;
				var bodyFontSize = bodyScale * 100 + "%";
				if(pageH > 2300) { // 如果是大屏幕(2304)
					pageW -= 47;
				}

				function pageResize() {
					$("body").css("font-size", bodyFontSize);
					$("#content").css("width", pageW);
					$(".fullScreen_map").css("width", pageW); //全屏页面是绝对定位,宽度100%只能取自屏幕
					console.log("~~~~~~~~~窗口高度：" + pageH + ",\n宽度:" + pageW + " \nbody字号：" + bodyFontSize)
				}
				pageResize()
		</script>
		<script src="${contextPath}/static/phm/js/health.js" type="text/javascript" charset="utf-8"></script>
		<!--陈新  -->
		<script type="text/javascript">
		
			$(function(){
				//console.log(Health);
				$.ajax({
					url:"http://localhost:8088/api/yzd/survey/all",
					type:"get",
					success:function(data){
						var total=data.linkNum;//接入量
						$("#total").html(total);
						var online=data.onlineSituation.onLine;//在线
						var offline=data.onlineSituation.offLine;//离线
						var healthPercent=data.health;//健康度 健康度为 “98%”
					
						healthPercent=parseFloat(healthPercent.replace(/%/,""));
						var productSituation=data.productSituation;//产品情况
						var xArray=[];seriesArray=[];
						for(var i=0;i<productSituation.length;i++){
							var productSitutationSingle=productSituation[i];
							productSitutationSingle.value=productSitutationSingle.num;
							xArray.push(productSitutationSingle.name);
							seriesArray.push(productSitutationSingle.num);
						}
						var prognostics=data.prognostics;//诊断预测
						
						var qualityTendency=data.qualityTendency;//质量趋势
						fridgeOnlinePercent(online,offline);//冰箱在线率初始化
						health(healthPercent,100-healthPercent);//健康度初始化
						healthSpread(productSituation);//健康分布初始化
						productBad(xArray,seriesArray);//不良产品 
						diagnose(prognostics);//诊断预测
						qualityTrend(qualityTendency);//质量趋势
						
					},
					error:function(){alert("加载health数据请求失败 ")}
					
				});
				/************************冰箱在线率 *********************************************/
					Health.bxzxl.showLoading();
					function fridgeOnlinePercent(online,offline){
						Health.bxzxl.hideLoading();
						//console.log(Health.bxzxl);
						Health.bxzxl.setOption({
							color:["#0066ff","#66ccff"],
							tooltip:{
								show:true,
								formatter: "{b} : {d}%" ,
								textStyle:{
									color:"#fff",
									fontSize:13*bodyScale
								},
							},
							series:[
								{
									type:'pie',
									name:'冰箱在线率',
									  
									itemStyle:{
										normal:{
											//color:"#dd0",
											label:{
												show:true,
												formatter: "{b}{d}%" ,
												textStyle:{
														color:"#fff",
														fontSize:13*bodyScale,
													},
												position:'inner'
											},
											labelLine:{
												show:false
											}
										},
										emphasis:{
											label:{
												show:true,
												formatter: "{b}{d}%" ,
												textStyle:{
														color:"#fff",
														fontSize:13*bodyScale
													},
												position:'inner'
											},
										}
									},
									data:[{value:online,name:"在线"},{value:offline,name:"离线"}],
									center:["50%","50%"],//圆心坐标
									radius:[0,"75%"],//内半径，外半径
									roseType:'radius',
								}
							]
						});
				}

				/**********************************健康度 *************************************************************************/
				Health.jkd.showLoading();
				function health(healthPercent, unhealthPercent) {
					Health.jkd.hideLoading();
					Health.jkd.setOption({
						color : [ "#44f4cd", "#105364" ],
						series : [ {
							type : 'pie',
							name : '健康度',
							center : [ "50%", "50%" ],//圆心坐标
							radius : [ "50%", "75%" ],//内半径，外半径
							itemStyle : {
								normal : {
									//color:"#dd0",
									label : {
										show : false,
										formatter : "{d}%",
										textStyle : {
											color : "#64ccff",
											fontSize : 30 * bodyScale,
										},
										position : 'center',
										verticalAlign : "middle",
										align : "center"

									},
									labelLine : {
										show : false
									}
								},
								emphasis : {
									label : {
										show : true,
										formatter : "{d}%",
										textStyle : {
											color : "#64ccff",
											fontSize : 30 * bodyScale,
										},
									//position:'center',
									//verticalAlign:"middle"
									},
								}
							},
							data : [ {
								value : healthPercent,
								name : "健康"
							}, {
								value : unhealthPercent,
								name : "不健康",
								label : {
									normal : {
										show : false
									},
									emphasis : {
										show : false,
									}

								}
							} ],
						} ],

					});
				}

				/***************************健康分布 ********************************************************************************/
				Health.jkfb.showLoading();
				function healthSpread(productSituation) {
					//console.log(productSituation);
					Health.jkfb.hideLoading();

					Health.jkfb.setOption({
						color:["#0066ff","#66ccff"],
						series : [ {
							type : 'pie',
							name : '冰箱在线率',

							itemStyle : {
								normal : {
									//color:"#dd0",
									label : {
										show : false,
									},
									labelLine : {
										show : false
									}
								},
								emphasis : {
									label : {
										show : false,
									},
								}
							},
							data : productSituation,
							center : [ "50%", "50%" ],//圆心坐标
							radius : [ 0, "75%" ],//内半径，外半径
							roseType : 'radius',
						} ]
					});
				}

				/**********************************不良产品情况 *************************************************************************/
				function productBad(xArray, seriesArray) {

					this.blcpqk = echarts.init(document
							.getElementById("blcpqk"));
					var blcpqkOptions = {
						color : [ "#5ed1ff" ],
						grid : {
							x : '12%',//左
							y : "8%",//上
							x2 : '5%',//右	
							y2 : "12%",//下
							containLabel : true,
							borderWidth : 0,
						},
						yAxis : {
							type : 'value',
							//max:1000,
							//min:0,
							//splitNumber:4,
							axisLine : {
								show : false
							},
							axisLabel : {
								textStyle : {
									color : "#64ccff",
									fontSize : 13 * bodyScale
								},
								margin : 10 * bodyScale
							},
							splitLine : {
								show : true,
								lineStyle : {
									color : '#1e3152',
									width : bodyScale
								}
							}
						},
						xAxis : {
							type : 'category',
							data : xArray,
							//max:8,
							//min:1,
							//splitNumber:7,
							axisLine : {
								show : false
							},
							axisLabel : {
								textStyle : {
									color : "#64ccff",
									fontSize : 13 * bodyScale
								}
							},
							splitLine : {
								show : false,
							}
						},
						series : [ {
							type : "bar",
							//data:[[1,875],[2,800],[3,475],[4,725],[5,700],[6,800],[7,650],[8,850]],
							data : seriesArray,
							barWidth : 13 * bodyScale
						} ]
					}

					this.blcpqk.setOption(blcpqkOptions);
				}

				/*********************************诊断预测 **************************************************************************/
				function diagnose(diagnoseArray) {
					var zdyc = echarts.init(document.getElementById("zdyc"));
					var zdycOptions = {
						color : [ "#5ed1ff" ],
						grid : {
							x : '12%',//左
							y : "8%",//上
							x2 : '5%',//右	
							y2 : "27%",//下
							containLabel : true,
							borderWidth : 0,
						},
						yAxis : {
							type : 'value',
							splitNumber : 4,
							axisLine : {
								show : false
							},
							axisLabel : {
								textStyle : {
									color : "#64ccff",
									fontSize : 13 * bodyScale
								},
								margin : 10 * bodyScale
							},
							splitLine : {
								show : true,
								lineStyle : {
									color : '#1e3152',
									width : bodyScale
								}
							}
						},
						xAxis : {
							type : 'category',
							data : [ "1月", "2月", "3月", "4月", "5月", "6月" ],
							axisLine : {
								show : false
							},
							axisLabel : {
								textStyle : {
									color : "#64ccff",
									fontSize : 13 * bodyScale
								}
							},
							splitLine : {
								show : false,
							},
							min : 1,
							max : 6,
							splitNumber : 5
						},
						series : [ {
							type : "line",
							//data:[[1,95],[2,77],[3,100],[4,80],[5,75],[6,90]],
							data : diagnoseArray,
							itemStyle : {
								normal : {
									lineStyle : {
										color : "#64ccff",
										width : 2 * bodyScale,
									//											shadowColor:"rgba(36,70,105,0.5)",
									//											shadowBlur:10,
									//											shadowOffsetY:1000
									}
								}
							}
						} ]
					}

					zdyc.setOption(zdycOptions);
				}

				/*******************************************质量趋势 ****************************************************************/
				function qualityTrend(qualityArray) {
					var zlqs = echarts.init(document.getElementById("zlqs"));
					var zlqsOptions = {
						color : [ "#5ed1ff" ],
						grid : {
							x : '12%',//左
							y : "8%",//上
							x2 : '5%',//右	
							y2 : "27%",//下
							containLabel : true,
							borderWidth : 0,
						},
						yAxis : {
							type : 'value',
							splitNumber : 4,
							axisLine : {
								show : false
							},
							axisLabel : {
								textStyle : {
									color : "#64ccff",
									fontSize : 13 * bodyScale
								},
								margin : 10 * bodyScale
							},
							splitLine : {
								show : true,
								lineStyle : {
									color : '#1e3152',
									width : bodyScale
								}
							}
						},
						xAxis : {
							type : 'category',
							data : [ "1周", "2周", "3周", "4周", "5周", "6周", "7周",
									"8周", "9周", "10周", "11周", "12周" ],
							axisLine : {
								show : false,

							},
							axisLabel : {
								interval : '0',
								textStyle : {
									color : "#64ccff",
									fontSize : 13 * bodyScale,

								}
							},
							splitLine : {
								show : false,
							},
						},
						series : [ {
							type : "line",
							data : qualityArray,
						} ]
					}

					zlqs.setOption(zlqsOptions);
				}

				/***********************************************************************************************************/

			})
		</script>
	</body>
</html>
