<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>首页动画</title>
    <link rel="stylesheet" href="${contextPath}/static/phm/css/indexAnimation.css">
    <script>

    </script>
</head>
<body>
<div class="myContainer">
    <div class="textPicBox">
        <h3>诊断预测模型</h3>
        <h4>诊断模型</h4>
        <img class="pic" src="${contextPath}/static/phm/images/strategy/zhenduan.png" alt="预测模型">
        <h4>预测模型</h4>
        <img class="pic" src="${contextPath}/static/phm/images/strategy/mod_1.png" alt="诊断模型">
    </div>
    <div class="textPicBox">
        <h3>基于大数据，利用相关性及神经网络建诊断预测模型</h3>
        <div class="picBox aiBox">
            <div class="aiBox1">
                <div class="line"></div>
                <div class="line"></div>
                <div class="line"></div>
            </div>
            <div class="aiBox2">
                <div class="line"></div>
                <div class="line"></div>
                <div class="line"></div>
            </div>
            <div class="aiBox3">
                <div class="line"></div>

            </div>
            <div class="aiBox4">
                <div class="line"></div>
            </div>
            <div class="aiBox5">
                <div class="line"></div>
            </div>
        </div>
        <div class="videoBox">
            <video src="${contextPath}/static/phm/video/cnnMovie.mp4"></video>
        </div>
    </div>
    <div class="animationBox-right light">
        <div class="line"></div>
        <div class="line"></div>
        <div class="line"></div>
        <div class="line"></div>
    </div>
    <div class="animationBox-center light">
        <div class="line"></div>
        <div class="line"></div>
        <div class="line"></div>
    </div>
    <div class="animationBox-left light">
        <div class="line"></div>
        <div class="line"></div>
        <div class="line"></div>
    </div>
    <div class="inputTextAnimation">
        <ul>

        </ul>
    </div>
</div>
<script src="${contextPath}/static/phm/assets/js/jquery-2.2.4.js" type="text/javascript" charset="utf-8"></script>
<script>
    setTimeout(function () {
        let bodyFontSize = parent.bodyFontSize;
        $("html").css("font-size",bodyFontSize);
    },300);

    // waiting代表动画前的等待时间
    //整体光效动画时间
    const lightObj = {
        "waiting": 1,
        "animationBox-right": 1,
        "waiting2": 5.5,
        "animationBox-center": 1,
        "waiting3": .5,
        "animationBox-left": 1,
    };
    const lightName = Object.keys(lightObj);
    //神经网络动画时间
    const aiObj = {
        "waiting": 1.5,
        "aiBox1": .25,
        "aiBox2": .25,
        "aiBox3": .25,
        "aiBox4": .25,
        "aiBox5": .25
    };
    const aiName = Object.keys(aiObj);

    function clear() {//循环前重置
        $("video")[0].load();
        $("video").parent().prev().css("transform","scale(1)");
        $(".line").removeClass("animate", 0);
    }
    $(function () {
        let allAnimate = function () {
            clear();
            let animationNext1 = animationGen1();
            let animationNext2 = animationGen2();

            /*整体进度动画*/
            start(animationNext1,lightObj);
            /*智神经网络动画*/
            start(animationNext2,aiObj);



            //开始动画
            function start(animationNext,obj) {
                animationCtr(0, animationNext,obj);
            }

            function * ctr() {
                // yield $(".textPicBox:eq(1)").fadeIn(250);
                yield $("video").parent().prev().css("transform","scale(0)");
                yield $("video")[0].play();
                // yield $(".textPicBox:nth-of-type(1)").fadeIn(250);
            }
            let ctrNext = ctr();
            let videoTimer = [3,2,1];
            videoTimer.reduce(function (prev,cur) {
                let tempTime = prev+cur;
                setTimeout(function () {
                    ctrNext.next();

                },(tempTime)*1000)
                return tempTime;
            })

            /*每一步动画的实现
            *  @param {number} i 第几步动画
            *  @param {fun} animationNext 传入本生成器
            *  @param {obj} obj 时间和动画控制对象
            * */
            function animationCtr(i, animationNext,obj) {
                let objName = Object.keys(obj);
                setTimeout(function () {
                    let $line = animationNext.next(animationNext).value;
                    if ($line) {
                        $line.find(".line").addClass("animate").css("animation-duration", obj[objName[i + 1]] + "s");
                    }
                }, obj[objName[i]] * 1000);
            }

            //总流程，生成器函数，让每一步动画等待执行完毕
            function* animationGen1() {
                for (let i = 0; i < lightName.length; i++) {
                    animationCtr(i, animationNext1,lightObj);
                    yield $("." + lightName[i]);
                }
            }

            //神经网络，生成器函数，让每一步动画等待执行完毕
            function* animationGen2() {
                for (let i = 0; i < aiName.length; i++) {
                    animationCtr(i, animationNext2,aiObj);
                    yield $("." + aiName[i]);
                }
            }
        }

        allAnimate();
        setInterval(function () {
            allAnimate();
        },12000)

    });


</script>
</body>
</html>