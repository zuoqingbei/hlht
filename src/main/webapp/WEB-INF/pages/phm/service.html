
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="PHM" content="phm二期"/>
		<title></title><!-- ${contextPath}/static/phm/css/common.css -->
		<link rel="stylesheet" href="${contextPath}/static/phm/css/common.css" />
		<link rel="stylesheet" href="${contextPath}/static/phm/css/service.css" />
		<link rel="stylesheet" type="text/css" href="${contextPath}/static/phm/asserts/css/normalize.css" />
		<link rel="stylesheet" type="text/css" href="${contextPath}/static/phm/asserts/css/htmleaf-demo.css">
		
    <!--chen xin js  -->
   
	</head>
	<body>
		<div id="content">
			<!--head-->
			<div id="head">
				<h1>
					<a href="${contextPath}/phm/index">
						<img src="${contextPath}/static/phm/images/status/logo_haier_bold.png" alt="" />
					</a>
				</h1>
				<h2><a href="${contextPath!}/phm" >物联网时代的用户最佳体验模式</a></h2>
			</div>
			
			<!--bottom-->
			<div id="bottom">
				<div class="left-table">
					<div class="title">诊断结果</div>
					
					<!-- <div class="btnBox">

						<div class="optionsBtn" onclick="showByFobject(this)" >主控板</div>
						<div class="optionsBtn" onclick="showByFobject(this)" >冷藏风机</div>
						<div class="optionsBtn" onclick="showByFobject(this)">电磁阀</div>
						
					</div> -->
					<table border="0" cellpadding="0" cellspacing="0" align="center">
						<thead>
							<tr class="row">
								<th class="col">对象<div class="slide"></div></th>
								<th class="col">故障现象<div class="slide"></div></th>
								<th class="col">失效原因<div class="slide"></div></th>
								<th class="col">维修措施<div class="slide"></div></th>
							</tr>
						</thead>
						<tbody class="content" id="faultInfo">
						
						</tbody>
					</table>
				</div>
				<!--center-map-->
				<div class="center-map">
					<div id="myMap" style="width:100%;height:100%"></div>
				</div>
				<div class="right-mode">
					<div class="sbox">
						<select >
							<option>一个月</option>
							<option>三个月</option>
							<option>半年</option>
							<option>一年</option>
							<option>两年</option>
							<option>三年</option>
							<option>三年以上</option>
						</select>
					</div>
					<!--right-bar1-->
					<div class="right-bar1">
						<p class="bar1-title">各区域备件需求</p>
						<div id="bar1" style="width:100%;height:100%"></div>
					</div>
					<!--right-bar2-->
					<div class="right-bar2">
						<p class="bar2-title">服务站能力匹配</p>
						<div id="bar2" style="width:100%;height:100%"></div>
					</div>
					<div style="clear:both;"></div>
				</div>
				
			</div>
		</div>
		
		
		
		
		<script src="${contextPath}/static/phm/asserts/js/jquery-2.2.4.js" type="text/javascript" charset="utf-8"></script>
		<!--<script src="../asserts/echarts3.0/echarts.js" type="text/javascript" charset="utf-8"></script>
		<script src="${contextPath}/static/phm/asserts/echarts3.0/china.js" type="text/javascript" charset="utf-8"></script>-->
		<script src="${contextPath}/static/phm/asserts/echarts/echarts-all.js" type="text/javascript" charset="utf-8"></script>
		
		<script src="${contextPath}/static/phm/js/service.js" type="text/javascript" charset="utf-8"></script>
	 <script type="text/javascript">
			 /*屏幕描述
		     一共 7x3 个屏幕，每一块屏幕是1360x768，
		     总共的大小就是9520x2304，比预计像素少7x6=42个像素。*/
		
		var pageH = $(window).height();
		var pageW = pageH * 16 * 7 / (9 * 3);
		var bodyScale = pageH / 595;
		var bodyFontSize = bodyScale * 100 + "%";
		if (pageH > 2300) { // 如果是大屏幕(2304)
		pageW -= 42
		}
		function pageResize() {
			$("body").css("font-size", bodyFontSize);
			$("#content").css("width", pageW);
			$(".fullScreen_map").css("width", pageW);//全屏页面是绝对定位,宽度100%只能取自屏幕
			//console.log("~~~~~~~~~窗口高度：" + pageH + ",\n宽度:"+pageW+" \nbody字号：" + bodyFontSize)
		}
		pageResize();
		
		var times=1;//用记录该加载第几页数据
	    var f_object="";//查询条件对象
    	$(function(){
    		getFaultInfo(true);	
    	});
    	var that;
		window.onload=function(){
			 that = this;
			var myHeight = 35*that.bodyScale;
			that.myHeight = 35*that.bodyScale;
			//$(".content").scroll(function(){
				//滚动条到顶部的距离
				// var totalheight = $(".content").scrollTop();
				//if (that.myHeight >totalheight) {
				//	times+=1;
				//	console.log("滑动times:",times);
				 //  that.myHeight += 2*$("tr").height();
			       getFaultInfo(false);	
				//} 
			//})
		}   
	    //获取故障详情信息
	    function getFaultInfo(isRefreshRight){
	    	//isRefreshRight--是否重新加载右侧数据
    		$.ajax({
    			type:"get",
    			url:"${contextPath}/data/findPageFaultInfo",
    			data:{page:times,pageSize:"20",fault_name:f_object}, 
    			success:function(data){
    				var faultInformation="";
	    			$.each(data,function(index,element){
	    				/* faultInfo */
	    				 // debugger; 
	    				faultInformation+=
	    				"<tr class='row'>"
		    				+"<td class='col'>"+element.fault_name+"<div class='slide'></div></td>"
		    				+"<td title="+element.fault_appearance+" class='col'>"+(element.fault_appearance.length>16?element.fault_appearance.substr(0,16):element.fault_appearance)+"<div class='slide'></div></td>"
		    				+"<td class='col'>"+(element.fault_resson==null?"":element.fault_resson)+"<div class='slide'></div></td>"
		    				+"<td class='col'>"+(element.fault_repair==null?"":element.fault_repair)+"<div class='slide'></div></td>"
	    				+"</tr>";
					
	    			});
	    			if(isRefreshRight){
	    				$("#faultInfo").html(faultInformation);
	    			}else{
	    				$("#faultInfo").append(faultInformation);
	    			}
    				/* console.log(data); */
    			},
    			error:function(){
    				//alert("加载信息错误 ")
    				}
    		}) ;
	    	if(isRefreshRight){
	    		//statisticsByDate();//加载 配件不同时段 需求 
	    	};
	    	
	    	tableScroll();
	    }
	    //不同零件故障信息切换
    	function showByFobject(obj){
			//the Scroll to top
			$(".content").scrollTop(0);
			Service.init();
    		Service.myHeight =  35*bodyScale;
    		
    		$(obj).siblings().removeClass("btnActive");
    		if($(obj).hasClass("btnActive")){
    			$(obj).removeClass("btnActive");
    			f_object="";
    			times=1;
    		}else{
    			$(obj).addClass("btnActive");
    			f_object=obj.innerHTML;
    			times=1;
    		};
    		getFaultInfo(true);
    		
    	}
	/******************************************************************************/
   //根据时间 查询部件需求 参数为 配件对象值 
	function statisticsByDate(){
		$.ajax({
				type:"get",
				url:"${contextPath}/data/findDeviceInfoByDate",
				data:{"fault_name":f_object},
				success:function(data){
				var myTimeEcharts = echarts.init(document.getElementById("bar2"));
					var timeEchartsOptions = {
						color: ['#00e96d'],
					    tooltip : {
					        trigger: 'axis',
					        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
					            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
					        },
					        textStyle:{
					        	fontSize:16*bodyScale
					        }
					    },
					    grid: {
					        x: '15%',//左
					        y:"25%",//上
					        x2: '10%',//右	
					        y2:"16%",//下
					        containLabel: true,
					    },
					    xAxis : [
					        {
					            type : 'category',
					            data : ['华中', '华东', '华北', '华南', '西南', '西北', '东北'],
					            axisTick: {
					                alignWithLabel: true
					            },
					            axisLabel:{
					            	interval:0,
					            	show:'true',
					            	rotate:-30,
					            	textStyle:{
					            		fontSize:16*bodyScale,
					            		color:'#64ccff'
					            	}
					            },
					           splitLine:{
					           	 show:false
					           },
					          
					        }
					    ],
					    yAxis : [
					        {
					            type : 'value',
					            name:'服务站数量/个',
					            nameLocation:'end',
					             nameGap:18*bodyScale,//坐标轴名称与轴线之间的距离
					             nameTextStyle:{
					            	color:'#64ccff',
					            	fontSize:16*bodyScale,
					            },
					           
					            splitNumber:5,
					            axisLabel:{
					            	show:'true',
					            	textStyle:{
					            		color:'#64ccff',
					            		fontSize:16*bodyScale,
					            	}
					            },
					            splitLine:{
					            	lineStyle:{
					            		color:['#123c62']
					            	}
					            }
					        }
					    ],
					    series : [
					        {
					            name:'服务站数量',
					            type:'bar',
			//		            barWidth: 30*that.bodyScale,
					            barGap:50*bodyScale,
					            cursor:'pointer',
					            data:data,
					            
					        }
					    ]
					}
		
				myTimeEcharts.setOption(timeEchartsOptions);
		
		
			}
		})
	}
	
	function selectEvent(){
		console.log("die")
		$("select").change(function(){
			console.log("dianjile")
			Service.echartsTime();
			//statisticsByDate();
			Service.echartsArea();
		})
	}
	var t;
	function tableScroll(){
		var n=0;
		  t = setInterval( function() {
			  n+=1;
	           $(".content").scrollTop(n);
	          // console.log(n)
	           if(n==860){n=0}
	        }, 50);
		  
	}
	
	
	selectEvent();		
    </script>
	</body>
</html>
