<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="PHM" content="phm二期"/>
		<title>实时状态</title>
		
		<link rel="stylesheet" href="${contextPath}/static/phm/css/common.css" />
		<link rel="stylesheet" href="${contextPath}/static/phm/css/status.css" />
		
		
	</head>
	<body>
		<div id="content">
			<!--head-->
			<div id="head">
				<h1>
					<a href="${contextPath}/phm/index">
						<img src="${contextPath}/static/phm/images/status/logo_haier_bold.png" alt="" />
					</a>
				</h1>
				<h2><a href="${contextPath!}/phm" >物联网时代的用户最佳体验模式</a></h2>
			</div>
			<!--bottom-->
			<div id="bottom">
				<!--bottom left-->
				<div class="map-mod">
					<div class="mapTitle">
						国内冰箱分布
					</div>
					<div id="myMap" style="width:100%;height:100%"></div>
				</div>
				<!--bottom bxbox-->
				<div class="bxbox">
					<div class="circle">
						<!-- <div id="container">
						    <canvas id="circleBox"></canvas>
						</div> -->
						<iframe id="light-if" width="100%" height="100%" frameborder="0" src="" scrolling="no"></iframe>
					</div>
					<div class="light light1"></div>
					<div class="light light2"></div>
					<div class="piontline"></div>
					<div class="view center-block mybx">
			            <div class="box">
			                <div class="box_front"><strong></strong></div>
			                <div class="box_back"><strong></strong></div>
			                <div class="box_top"><strong></strong></div>
			                <div class="box_bottom"><strong>底部</strong></div>
			                <div class="box_left"><strong></strong></div>
			                <div class="box_right"><strong></strong></div>
			                <div class="box_compressor"><strong></strong></div>
			                <div class="box_compressor addon"><strong></strong></div>
			            </div>
			        </div>
					<a href="${contextPath!}/phm/service" style="color:#fff"><div class="bxinfo">
						<div class="xinghao infobox">
							<p class="txt1">型号：</p>
							<p class="txt2" id="sncode"></p>
						</div>
						<div class="start infobox">
							<p class="txt1">启用时间：</p>
							<p class="txt2">2018年1月26日</p>
						</div>
						<div class="address infobox">
							<p class="txt1">地址：</p>
							<p class="txt2" id="address"></p>
						</div>
						<div class="state infobox">
							<p class="txt1">健康状态：</p>
							<p class="txt2" id="status"></p>
						</div>
						<div class="time infobox">
							<p class="txt1">运行总时长：</p>
							<p class="txt2">3840h</p>
						</div>
					</div>
				</div></a>
				<!--bottom right-->
				<div class="statusBox">
					<div class="leftBtn fyBtn" onclick="pageLeft()" id="pageLeft"></div>
					<div class="rightBtn fyBtn" onclick="pageRight()" id="pageRight"></div>
					<div class="titleBox">
						
						<div class="tnav sszt navActive" onclick="timeStatusChange()">实时状态</div>
						<div class="tnav syfx" onclick="useAnalysis()">使用分析</div>	
						<div class="tnav ztqs">状态趋势</div>
						<div class="tnav gzyc">寿命预测</div>
						<div class="tnav gzzd">故障诊断</div>
						
					</div>
					<div class="bottomState">
						<div class="state-box-contain">
							<div class="state-box">
								<!--实时状态-->
								<div class="leftStates" id="firstPage"></div>
							   <!--  <div class="leftStates" id="secondPage"></div> -->
								<!-- <div class="leftStates" id="thirdPage" style="display:none;"></div>
								<div class="leftStates" id="fourPage" style="display:none;"></div> -->
									
								<!--使用分析-->
								<div class="syfxBox" id="analysisFirstPage"></div>
								
								<div class="syfxBox" id="analysisSecondPage"></div>
								
								<!--状态趋势-->
								<div class="ztqsBox">
									<!-- <iframe src="http://47.95.109.158/#/product/20171026BX001" width="100%" height="100%"></iframe> -->
									<div id="ztqsCanvas" style="width:100%;height:100%"></div>
								</div>
								<!--故障诊断-->
								<div class="gzzdBox">
									
								</div>
								<!--故障预测-->
								<div class="gzycBox">
									<div class="totalInfo">
										<p class="titleintro">综合预测信息</p>
										<p class="item itemf">预测计算时间：<span></span></p>
										<p class="item items">预测剩余寿命：<span></span></p>
										<div class="smycBox">
											<div id="smycCanvas" style="width:100%;height:100%"></div>
										</div>
									</div>
									
								</div>
							</div>
						</div>
						
					</div>
				</div>
			</div>
		</div>
		
		
		
		<script src="${contextPath}/static/phm/asserts/echarts/echarts-all-2.2.7.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="${contextPath}/static/phm/asserts/js/jquery-2.2.4.js"  type="text/javascript" charset="utf-8"></script>
		
		<script>
		        /*屏幕描述
				         一共 7x3 个屏幕，每一块屏幕是1360x768，
				         总共的大小就是9520x2304，比预计像素少7x6=42个像素。*/
				
		        var pageH = $(window).height();
		        var pageW = pageH * 16 * 7 / (9 * 3);
		        var bodyScale = pageH / 595;
		        var bodyFontSize = bodyScale * 100 + "%";
		        if (pageH > 2300) { // 如果是大屏幕(2304)
		            pageW -= 47
		        }
		        function pageResize() {
		            $("body").css("font-size", bodyFontSize);
		            $("#content").css("width", pageW);
		            $(".fullScreen_map").css("width", pageW);//全屏页面是绝对定位,宽度100%只能取自屏幕
		           // console.log("~~~~~~~~~窗口高度：" + pageH + ",\n宽度:"+pageW+" \nbody字号：" + bodyFontSize)
		        }
		        pageResize()
   		</script>
		<script src="${contextPath}/static/phm/js/status.js" type="text/javascript" charset="utf-8"></script>
	
	<!--陈新   -->
		<!--实时状态  -->
			<script type="text/javascript" charset="utf-8">
			var sncode="";//定义sncode 
			var addId="http://10.138.87.129";
			var bodyScale=$(window).height()/595;
			var that=this;
			var optionArray=[];
			<!--**********************转速 初始化***************************************   -->
				function speedometer(zs,value,times,max,min,title,label){
					if(!zs){
					 zs = echarts.init(document.getElementById("zsCanvas"+times));
					}
				//	console.log(times)
					var unit = "";//单位
					if(times == 28){
						unit = "V";
					}else {
						unit = "A";
					}
					var zsOption={

							title:{
								text:label,
								x:62*bodyScale,
								y:70*bodyScale,
								textStyle:{
									color:'#64ccff',
									fontSize:13*bodyScale
								}
							},
//							 tooltip : {
//						        formatter: "{a} <br/>{b} : {c}"
//						    },
						    series : [
						        {
						            name:title,
						            type:'gauge',
						            detail : {
						            	formatter:'{value}'+" " +unit,
						            	textStyle:{
						            		color:'#64ccff',
						            		fontSize:15*bodyScale,
						            		fontWeight:600,
						            	}
						            },
						           data:[{value: value}],
						          itemStyle:{
						          	color:'#64ccff'
						          },
						          /* startAngle:200,
						          endAngle:-20, */
						          startAngle:200,
						          endAngle:-20,
						          min:min,
						          max:max,
						          //radius:"[2%,75%]",
						          radius:["80%","100%"],
						          center:["50%","60%"],
						          axisLine:{
						          	show:true,
						            lineStyle:{
						            	color:'#64ccff',
						              width:14*bodyScale
						            }
						          },
						          axisLabel:{
						          	textStyle:{
						          		color:'#fff',
						          		fontSize:7*that.bodyScale,
						          	}
						          },
						          splitLine:{
						          	length:bodyScale,
						          	lineStyle:{
						          		color:'#64ccff',
						          		width:2*bodyScale
						          	}
						          },
						          axisTick:{
						          	show:false
						          },
						          pointer:{
						          	length:40*bodyScale,
						            width:5*bodyScale,
						            color:'#dd0'
						          },
						          title:{
						          	show:true,
						          	
						          }
						        }
						    ]
						
					}
					zs.setOption(zsOption,true);
					optionArray[times]=zs;
				}
			/* **********************************仪表初始化 **************************************  */
				function gauge(zs,value,times,max,min,title,label,percent){
				if(!zs){
					 zs = echarts.init(document.getElementById("Canvas"+times));
				}
					var zsOption={
					title:{
						text:label,
						x:40*bodyScale,
						y:50*bodyScale,
						textStyle:{
							color:'#64ccff',
							fontSize:13*bodyScale
						}
					},
					 tooltip : {
				        formatter: "{a} <br/>{b} : {c}"
				    },
				    series : [
				        {
				            name:title,
				            type:'gauge',
				            detail : {formatter:'{value}',
				            	textStyle:{
				            		color:'#64ccff',
				            		fontSize:15*bodyScale,
				            		fontWeight:600,
				            	},
				            	offsetCenter:[0,'-5%']
				            },
				            data:[{value: value}],
				          itemStyle:{
				          	color:'#64ccff'
				          },
				          startAngle:200,
				          endAngle:-20,
				          min:min,
				          max:max,
				          //radius:"[2%,75%]",
				          radius:["80%","100%"],
				          center:["50%","60%"],
				          axisLine:{
				          	show:true,
				            lineStyle:{
				            	color:[
				            		[percent,'#64ccff'],
				            		[1,'#0a5365']
				            	],
				              width:15*bodyScale
				            }
				          },
				          splitLine:{
				          	show:false
				          },
				          axisTick:{
				          	show:false
				          },
				          axisLabel:{
				          	show:false
				          },
				          pointer:{
				          	length:0,
				            width:0,
				            color:'#dd0'
				          },
				          title:{
				          	show:true,
				          	
				          }
				        }
				    ]
				
					}
					zs.setOption(zsOption,true);
					optionArray[times]=zs;
				
			}
			//var sortArr=["T1","T2","T3","T4","T5","T6","T7","T8","T9","T10","U1","U2","R1"];
			var sortArr=["T1","T2","T4","U1","I2","I1",
			             "S1","S2","S3","S4","S5",
			             "T3","V2","W1","T5","T6","T7",
			             "M1","S6","S7","S13","S9","S12",
			             "T8","V5","T9","T10","V3","V4"];
			function sort(monitorConf){
				monitorConf=sortType(monitorConf);//将温度计往前排 初公要求
				var result=[];
				var other=[];
				for(var x=0;x<sortArr.length;x++){
					$.each(monitorConf,function(index,item){
						if(item.feature==sortArr[x]){
							result.push(item);
							return true ;
						};
					});
				};
				
				$.each(monitorConf,function(index,item){
					if(sortArr.indexOf(item.feature)==-1){
						other.push(item);
						return true ;
					};
				});
				//debugger;
			//	return result.concat(other);
			return removeDoorStatus(result.concat(other));
			}
		/*****************************************************************************************/
			function removeDoorStatus(monitorConf){//因为把 冰箱的四个参数一起显示到了同一位置 ，所以要monitorConf删除 这些 信息 
				for(var i=0;i<monitorConf.length;i++){
					//if(monitorConf[i].feature=="S16"){debugger;}
					if(monitorConf[i].feature=="S14"||monitorConf[i].feature=="S15"||monitorConf[i].feature=="S16"||monitorConf[i].feature=="S17"){
						monitorConf.splice(i,1);
						i=i-1;
					}
					
				}
				return monitorConf;
			
		}
		/********************************/
			function sortType(monitorConf){//将温度计往前排
			var thermometer=[];
			var other=[];
				for (var i=0;i<monitorConf.length;i++){
						var monitorConfSingle=monitorConf[i];
						if(monitorConfSingle.type=="thermometer"){
							thermometer.push(monitorConfSingle);
						}else{
							other.push(monitorConfSingle);
						}
				}
				return thermometer.concat(other);
			
		}
			function contains(arr, obj) {  
			    var i = arr.length;  
			    while (i--) {  
			        if (arr[i] === obj) {  
			            return true;  
			        }  
			    }  
			    return false;  
			}  
		function getPicIndex(times){
			var indexImg=0;
			var arr=[32,33,34,35];
			for(var x=0;x<arr.length;x++){
				if((times-arr[x])%11==0){
					indexImg=arr[x];
					break;
				}
			}
			if(indexImg==0){
				indexImg=times;
			}
		/* 	if(!contains(arr,indexImg)){
				indexImg=arr[0];
			} */
			return indexImg;
			
		}
			
			/* ********************************************************************************* */
			<!--实时状态初始化  -->
			function timeStatus(){
				times=0;
				idFlage=pagnum;
				optionArray=[];
				idFlage=idFlage+pagnum;
				var times=0;
				if(idFlage>1000){idFlage=0;}
				times=times+idFlage;
				// pageNo=1;//记录第几页
				// pagnum=0;//记录该更新 哪一部分pagnum
				if(sncode==""||sncode==undefined){
					return;
				}
			
				//根据机器型号跳转到对应的iframe
				$(".gzzd").click(function(){
					$("#gzzdIframe").attr("src",addId+"/#/product/"+sncode);
				});
				
				
				$.ajax({
					//url:"http://localhost:8088/api/yzd/product/"+sncode,
					url:addId+"/api/yzd/product/"+sncode,
					type:"get",
					success:function(data){
						//console.log(data.monitorConf)
						data.monitorConf=sort(data.monitorConf);
					//	console.log(data.monitorConf);
						dataLength=data.monitorConf.length;
						
						//debugger;
						var location=data.location;
						var info=data.info;
						var S14=info['S14'];
						var S15=info['S15'];
						var S16=info['S16'];
						var S17=info['S17'];
						var monitorConf=data.monitorConf;
						var start =(pageNo-1)*pagnum;//截取数据开始位子,由于加了一张开关门要-1
						var end=start+pagnum-1;//截取数据结束位子
						if(pageNo!=1){
							start=start-1;
						}
						
						 monitorConf=monitorConf.slice(start,end);
						
							for( var index in monitorConf){
								//debugger;
								var monitorConfSingle=monitorConf[index];
								var param=monitorConfSingle.param;
								var title="";
								var label="";
								var max="";
								var min="";
								var actualStatus="";
								var type=monitorConfSingle.type;
								var feature=monitorConfSingle.feature;
									 actualStatus=info[feature];
								var charts="";
							
									 title=param.title;
									 label=param.label;
									 max=param.max;
									 min=param.min;
								 var t1=6+idFlage;
								if(times==t1&&pageNo==1){
									//S14=1;
									times+=1;
									
									if(!S14||!S15||!S16||!S17 ){
										var image=
											"<div id='cx"+times+"'  class='jtState mt1'>"+
											"<p style='margin-left:17%;' class='stateTxt'>冰箱开关门</p>"+
											
										    "<div style='margin-top: 14%;'><span style='margin:27% 16%;display:block;'>开关门缺失数据</span></div>"+
										"</div>";
										$("#firstPage").append(image);
									}else{
										var image14="";var image15="";var image16="";var image17="";
										var image14url;var image15url;var image16url;var image17url;
										if(S14==0){
											image14="冷藏室左门关闭";
											image14url="leftClose.png";
										}else if(S14==1){
											image14="冷藏室左门开启";
											image14url="leftOpen.png";
										}
										if(S15==0){
											image14="冷藏室右门关闭";
											image15url="rightClose.png";
										}else if(S15==1){
											image15="冷藏室右门开启";
											image15url="rightOpen.png";
										}
										if(S16==0){
											image16="冷冻室上门关闭";
											image16url="upClose.png";
										}else if(S16==1){
											image16="冷冻室上门开启";
											image16url="upOpen.png";
										}
										if(S17==0){
											image17="冷冻室下门关闭";
											image17url="downClose.png";
										}else if(S17==1){
											image17="冷冻室下门开启";
											image17url="downOpen.png";
										}
										
										var image=
											"<div id='cx"+times+"'  class='jtState mt1'>"+
												"<p class='stateTxt'>冰箱开关门</p>"+
												"<div class='bxDoor'>"+
													"<div class='bxImgLeft'>"+
														"<img src='${contextPath}/static/phm/images/status/"+image14url+"' alt='' />"+
														"<img src='${contextPath}/static/phm/images/status/"+image15url+"' alt='' />"+
														"<img src='${contextPath}/static/phm/images/status/"+image16url+"' alt='' />"+
														"<img src='${contextPath}/static/phm/images/status/"+image17url+"' alt='' />"+
													"</div>"+
												"</div>"+
											"</div>";
										$("#firstPage").append(image);
									}
									
								}
								var changeClass="";
								/**************处理状态 ****************/
								if(type=="text"&&nowInfo.indexOf(feature)!=-1){
									if(times%pagnum>5){
										changeClass="mt1";
									}
									times+=1;var value="";
									var infoArray=statusInfo[feature];//获取对应的 数组对照信息
									var statusValue=info[feature];//获取当前传入状态值 
									//debugger; 
									//console.log(infoArray);
									if(feature=="M1"){
										console.log(statusValue+"--"+feature)
									}
									var imgName=null;
									for(var i=0;i<infoArray.length;i++){
										
										var v=infoArray[i];
										if(v.key=="000"+statusValue){
											console.log(infoArray[i],"000"+statusValue);
											value=v.value;
											imgName=v.img;
											console.log(imgName);
											break;
										}
									}
									
									var charts=
										"<div id='cx"+times+"'  class='jtState "+changeClass+"'>"+
											"<p class='stateTxt'>"+title+"</p>"+
											"<div class='lcsLight myImgBox' >"+
												"<img src='${contextPath}/static/phm/images/status/"+imgName+"' alt='图片' />"+
											"</div>"+
											"<p class='txtInfo'>当前状态:<span>"+value+"</span></p>"+
										"</div>";
										if (imgName!=null)
											$("#firstPage").append(charts);
									//debugger;
									continue;
								}else if(!max&&max!="0"){
									type="text";
									label="最大值数据缺失";
								}else if(!min&&min!="0"){
									type="text";
									label="最小值数据缺失";
								}else if(!actualStatus&&actualStatus!="0"){
									type="text";
									label="实际值数据缺失";
								}
									
						//	var changeClass="";
								if(times%pagnum>5){//用于判断是否进入第二 行 并添加margin-top
									changeClass="mt1";
								}
								if(type=="thermometer"){
									times+=1;
									charts+=
									"<div id='cx"+times+"' class='jtState "+changeClass+"'>"+
										"<p class='stateTxt'>"+title+"</p>"+
										"<div class='myState'></div>"+
										"<div class='track'>"+
											"<div class='liquid liquid"+times+"'></div>"+
										"</div>"+
										"<div class='max'>"+max+"</div>"+
									    "<div class='mid'></div>"+
									    "<div class='min'>"+min+"</div>"+
									    "<div class='tempTxt'>"+actualStatus+"</div>"+
									"</div>";
									var myarr=new Array();
									
									
									
										$("#firstPage").append(charts);
									if(actualStatus==undefined){actualStatus=(max+min)/2;}
									if(actualStatus<min){min=actualStatus-4;}
									 myarr[0]=["liquid"+times,max,min,actualStatus,"℃"];
									 Status.liquidMove(myarr);
								}if(type=="speedometer"){
									//debugger;
									times+=1;
									charts+=
										"<div id='cx"+times+"' class='jtState "+changeClass+"'>"+
											"<p class='stateTxt'>"+title+"</p>"+
											"<div class='canvBox'>"+
												"<div id='zsCanvas"+times+"' style='width:100%;height:100%'></div>"+
											"</div>"+
										"</div>";
										$("#firstPage").append(charts);
										var zs;
									speedometer(zs,actualStatus,times,max,min,title,label);
								}else if(type=="gauge"){
									//debugger;
									times+=1;
									charts+=
										"<div id='cx"+times+"'  class='jtState "+changeClass+"'>"+
											"<p class='stateTxt'>"+title+"</p>"+
											"<div class='canvBox'>"+
												"<div id='Canvas"+times+"' style='width:100%;height:100%'></div>"+
											"</div>"+
										
										"</div>";
										$("#firstPage").append(charts);
									
									var percent=(actualStatus-min)/(max-min);
									var zs;
									gauge(zs,actualStatus,times,max,min,title,label,percent);
									
								}else if(type=="text"){
									
									times+=1;
									charts+=
										"<div id='cx"+times+"'  class='jtState "+changeClass+"'>"+
											"<p style='margin-left:17%;' class='stateTxt'>"+title+"</p>"+
											
										    "<div style='margin-top: 14%;'><span style='margin:27% 16%;display:block;'>"+(label==undefined?"暂无数据":label)+"</span></div>"+
										"</div>";
										$("#firstPage").append(charts);
								}
							}
							
						/*****************************************************************************************************/	
							
					},
				//	error:function(){alert("实时加载错误");}
				
				});
				
			}
			/**********************************使用分析 **************************************************/
			var useAnalysisPageSize=4;
			function useAnalysis(){
				if(sncode==""){
					return;
				}
					$.ajax({
						url:"${contextPath}/data/getDeviceUseAnalysisByDeviceSncode",
						type:"post",
						data:{'device_info_sncode':sncode},
						success:function(data){
							var f=1;
							var first="";var second="";
							var margleft=""; var margtop="";
							if(data.length<=useAnalysisPageSize){
								hidePageBtn();
							}else{
								showPageBtn();
							}
							$.each(data,function(index,element){
								 if(f%3!=1){
									 margleft="margleft";
								 }
								 if(f%useAnalysisPageSize>3||(f%useAnalysisPageSize==0&&f>3)){
									 margtop="margtop";
								 }
									var content=
										"<div class='problemBox "+margleft+" "+margtop+"'>"+
											"<div class='imgBox '>"+
												"<img src='${contextPath}/static/phm/images/"+element.imageurl+"' alt='' />"+
											"</div>"+
											"<div class='rightInfo'>"+
												"<h6>"+element.title+"</h6>";
									
									
									if(element.desc1!=""&&element.desc1!=null){
										content+="<p>"+element.desc1+"</p>";
									}
									if(element.desc2!=""&&element.desc2!=null){
										content+="<p>"+element.desc2+"</p>";
									}
									if(element.desc3!=""&&element.desc3!=null){
										content+="<p>"+element.desc3+"</p>";
									}
									if(element.desc4!=""&&element.desc4!=null){
										content+="<p>"+element.desc4+"</p>";
									}
									if(element.result1!=""&&element.result1!=null){
										content+="<p>分析："+element.result1+"</p>";
									}
									if(element.result2!=""&&element.result2!=null){
										content+="<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+element.result2+"</p>";
									}
									content+="</div></div>";
									
									if(index == 1) {
										content +=  "<div class='problemBox "+margleft+" "+margtop+"'>"+
										"<div class='imgBox '>"+
											"<img src='${contextPath}/static/phm/images/d2.jpg' alt='' style='width:50%;height:60%;margin:20% auto'/>"+
										"</div>"+
										"<div class='rightInfo'>"+
											"<h6>整机输入电压</h6>"+
										"</div></div>";
										
										
									}
									
									if(index == 3) {
										content +=  "<div class='problemBox "+margleft+" "+margtop+"'>"+
										"<div class='imgBox '>"+
											"<img src='${contextPath}/static/phm/images/d1.jpg' alt='' style='width:50%;height:60%;margin:20% auto'/>"+
										"</div>"+
										"<div class='rightInfo'>"+
											"<h6>整机输入电流</h6>"+
										"</div></div>";
									}
									if(f>useAnalysisPageSize){
										second+=content;
									}else{
										first+=content;
									}
									margleft="";
									margtop="";
									f+=1;
								
									
								
							});
							
							console.log(content);
							
							
							$("#analysisFirstPage").html(first);
							$("#analysisSecondPage").html(second);
						},
					//	error:function(){alert("使用分析加载错误 ");}
						
						
						
					});
				
				
				
			}
			/***********************************地图 *******************************************************/
		function mapChina(serious,general,light,good,arr,geoCoord){
				var myMapCharts = echarts.init(document.getElementById("myMap"));
				var mapChartsOptions = {
					dataRange: {
				        min : 0,
				        max : 100,
				        precision:0,
				        itemWidth:20*bodyScale,
						itemHeight:10*bodyScale,
				        calculable : true,//不可拖动
				        padding:10*bodyScale,
				        color: ['lime','lime', 'lime','lime','lime'],
				        textStyle:{
				            color:'#fff',
				            fontSize:13*bodyScale
				        }
				    },
				    tooltip: {
				         show: false, //不显示提示标签
			            formatter: '{b}', //提示标签格式
			            backgroundColor:"#ff7f50",//提示标签背景颜色
			            textStyle:{
			            	color:"#fff",
				        	fontSize:16*bodyScale
			            } //提示标签字体颜色
			        },
					series : [
				        {
				            name: '全国',
				            type: 'map',
				            mapType: 'china',
				            clickable:false,
				         /* 	geoCoord: {
				                '上海': ["121.4648","31.2891"],
				                '基准': ["156","48"],
				                address
						 },  */
							geoCoord:geoCoord,
				            itemStyle: {
				                normal: {
				                	color:'#0091d1',
				                    borderWidth: 1.5*bodyScale,//区域边框宽度
				                    borderColor: '#000619',//区域边框颜色
				                    areaColor:'#0091d0',//区域颜色
				                },
				                emphasis: {
//				                    color:"#00e673",
				                }
			           	 	},
				            data:[],
				            markLine : {
				                smooth:true,
				                smoothness:0,
				                symbol:['none','none'],
				                symbolSize:[10*that.bodyScale,10*that.bodyScale],
				                effect : {
				                    show: true,
				                    scaleSize: 1,
				                    period: 15,//运动周期
				                    color: '#fff',
				                    shadowBlur: 10
				                },
				                itemStyle : {
				                    normal: {
				                        borderWidth:1*that.bodyScale,
				                        lineStyle: {
				                            type: 'solid',
				                            color:'#64ccff',
				                            shadowBlur: 10
				                        }
				                    }
				                },
				            	 data : arr
				            },
				        },
				        {
				            name: '良好',
				            type: 'map',
				            mapType: 'china',
				            data:[],
				            markPoint : {
				                symbol:'circle',
			            		symbolSize:5*bodyScale,
				                effect : {
				                    show: true,
				                    shadowBlur : 0,
				                    period:5
				                },
				                itemStyle:{
				                    normal:{
				                    	color:'lime',
				                        label:{show:false}
				                    },
				                    emphasis: {
				                        label:{position:'top'}
				                    }
				                },
				                data:good
				            }
				            
				        },
				        {
				            name: '一般',
				            type: 'map',
				            mapType: 'china',
				            data:[],
				            markPoint : {
				                symbol:'circle',
			            		symbolSize:5*bodyScale,
				                effect : {
				                    show: true,
				                    shadowBlur : 0,
				                    period:5
				                },
				                itemStyle:{
				                    normal:{
				                    	color:'lime',
				                        label:{show:false}
				                    },
				                    emphasis: {
				                        label:{position:'top'}
				                    }
				                },
				                data :general
				            }
				        } ,
				        
				        {
				            name: '轻微',
				            type: 'map',
				            mapType: 'china',
				            data:[],
				            markPoint : {
				                symbol:'circle',
			            		symbolSize:5*bodyScale,
				                effect : {
				                    show: true,
				                    shadowBlur : 0,
				                    period:5
				                },
				                itemStyle:{
				                    normal:{
				                    	color:'lime',
				                        label:{show:false}
				                    },
				                    emphasis: {
				                        label:{position:'top'}
				                    }
				                },
				                data :light
				            }
				        } ,
				        {
				            name: '严重',
				            type: 'map',
				            mapType: 'china',
				            data:[],
				            markPoint : {
				                symbol:'circle',
			            		symbolSize:5*bodyScale,
				                effect : {
				                    show: true,
				                    shadowBlur : 0,
				                    period:5
				                },
				                itemStyle:{
				                    normal:{
				                    	color:'lime',
				                        label:{show:false}
				                    },
				                    emphasis: {
				                        label:{position:'top'}
				                    }
				                },
				                data :serious
				            }
				        } 
				        
				        
				    ]
				}
				myMapCharts.setOption(mapChartsOptions);
			
				/*******************地图点击事件 下 *****************************/
				myMapCharts.on('click',function(param){
					
					var tempSncode=sncode;
					sncode=param.data.sncode;
					var name = param.data.name;
					$("#sncode").html(sncode);
					$("#address").html(name);
					$("#status").html(param.data.status);
					 arr=[ [{name:name},{name:'基线'}] ];
					
				
					 $(".state-box").css({"left":"0"});
					$("#analysisFirstPage").html("");
					$("#analysisSecondPage").html("");
					useAnalysis();//更新使用分析
					$("#firstPage").html("");
					pageNo=1;//将实时状态分页置为第一页
					timeStatus();//更新实时状态
					mapChartsOptions.series[0].markLine.data=arr;
					myMapCharts.clear();
					myMapCharts.setOption(mapChartsOptions);
					
		              	/**********************/	
		              	
		              	
		              	
					var navs = $(".tnav");
					for(var nav of navs){
						$(nav).removeClass("navActive");
					}
					//给点击的nav加active样式
					$(".sszt").addClass("navActive");
					
					//切换内容
					$(".leftStates").css("display","block");
					$(".syfxBox").css("display","none");
					$(".ztqsBox").css("display","none");
					//改变宽度
					$(".state-box").css("width","200%");	
					/************************重新加载冰箱信息框的动画**********************/
					$(".bxinfo").hide();
					$(".infobox").hide();
					$(".bxinfo").show(500,function(){
						//$(".infobox").hide();
						$(".infobox").show(500);
					});
					
				});
				/*******************地图点击事件 上面  *****************************/
			}
			/***********************************初始化 加载设备信息 并进行默认选中**********************************************/
			var timer;//定时器 
			$(function(){
				//setTimeout(function(){
				//	mapChina()
			//	},2000);
				
				$.ajax({
					url:"${contextPath}/data/findDeviceInfoStatusGroup",
					type:"get",
					success:function(data){
						var serious=new Array();
						var general=new Array();
						var light=new Array();
						var good=new Array();
						 serious=data.serious;
						 general=data.general;
						 light=data.light;
						 good=data.good;
						var geoCoord={'基线':["140","32"]};
						console.log("-------",data)
						var address=data.address;
						for(var i=0;i<address.length;i++){
							var obj=address[i];
							for(var j in obj){
								geoCoord[j]=obj[j];
							}
						}
						 var arr=[[]];
						 if(good.length>0){
							 arr=[ [{name:good[2].name},{name:'基线'}] ];
						 }else if(light.length>0){
							 arr=[ [{name:light[0].name},{name:'基线'}] ];
						 }else if(general.length>0){
							 arr=[ [{name:general[0].name},{name:'基线'}] ];
						 }else if(serious.length>0){
							 arr=[ [{name:serious[0].name},{name:'基线'}] ];
						 }
					 	sncode=good[2].sncode;
						$("#sncode").html(sncode);
						$("#address").html(good[2].name);
						$("#status").html(good[2].status);
						
						//Status.delayIframe(sncode);
						//document.getElementById("video").src="${contextPath}/static/phm/"+good[0].image;
					
						//var arr=[ [{name:good[0].name},{name:'基线'}] ];
 
						//useAnalysis();//更新使用分析
						timeStatus();//更新实时状态 
						setTimeout(function(){
							mapChina(serious,general,light,good,arr,geoCoord);
						},0);
						timer=setInterval(function(){
							updateStatus();
						},3000);
						
					},
				//	error:function(){alert("加载 地图信息错误 ");}
					
					
				})
			});
			/*********************定时更新 实时状态 ****************************/
		function updateStatus(){
				var times=idFlage;
				var length;//根据截取的数据长度 在后面判断要不要清空 对应的 数据 
			
			$.ajax({
				//url:"http://localhost:8088/api/yzd/product/"+sncode,
				url:addId+"/api/yzd/product/"+sncode,
				type:"get",
				success:function(data){
					//console.log(data.monitorConf)
					data.monitorConf=sort(data.monitorConf);
				//	console.log(data.monitorConf);
					var location=data.location;
					var info=data.info;
					var S14=info['S14'];
					var S15=info['S15'];
					var S16=info['S16'];
					var S17=info['S17'];
					//debugger;
					var monitorConf=data.monitorConf;
					//console.log(monitorConf);
					var start =(pageNo-1)*pagnum;//截取数据开始位子,由于加了一张开关门要-1
					var end=start+pagnum-1;//截取数据结束位子
					if(pageNo!=1){
						start=start-1;
					}
					 monitorConf=monitorConf.slice(start,end);
					
					length=monitorConf.length;
					if(length==0){
						return;
					}
					//console.log(monitorConf);
						for( var index in monitorConf){
							//debugger;
							var monitorConfSingle=monitorConf[index];
							var param=monitorConfSingle.param;
							var title="";
							var label="";
							var max="";
							var min="";
							var actualStatus="";
							var type=monitorConfSingle.type;
							var feature=monitorConfSingle.feature;
								 actualStatus=info[feature];
							var charts="";
						
								 title=param.title;
								 label=param.label;
								 max=param.max;
								 min=param.min;
								 var t1=6+idFlage;
								 //处理冰箱门
								 if(times==t1&&pageNo==1){
										//S14=1;
										times+=1;
										//debugger;
										if(!S14||!S15||!S16||!S17){
											
											var image=
												//"<div id='cx"+times+"'  class='jtState mt1'>"+
												"<p style='margin-left:17%;' class='stateTxt'>冰箱开关门</p>"+
												
											    "<div style='margin-top: 14%;'><span style='margin:27% 16%;display:block;'>开关门缺失数据</span></div>";
										//	"</div>";
											$("#cx"+times).html(image);
										}else{
											var image14url;var image15url;var image16url;var image17url;
											if(S14==0){
												image14url="leftClose.png";
											}else if(S14==1){
												image14url="leftOpen.png";
											}
											if(S15==0){
												image15url="rightClose.png";
											}else if(S15==1){
												image15url="rightOpen.png";
											}
											if(S16==0){
												image16url="upClose.png";
											}else if(S16==1){
												image16url="upOpen.png";
											}
											if(S17==0){
												image17url="downClose.png";
											}else if(S17==1){
												image17url="downOpen.png";
											}
											
											var image=
											//	"<div id='cx"+times+"'  class='jtState mt1'>"+
													"<p class='stateTxt'>冰箱开关门</p>"+
													"<div class='bxDoor'>"+
														"<div class='bxImgLeft'>"+
														"<img src='${contextPath}/static/phm/images/status/"+image14url+"' alt='' />"+
														"<img src='${contextPath}/static/phm/images/status/"+image15url+"' alt='' />"+
														"<img src='${contextPath}/static/phm/images/status/"+image16url+"' alt='' />"+
														"<img src='${contextPath}/static/phm/images/status/"+image17url+"' alt='' />"+
														"</div>"+
													"</div>";
												//"</div>";
												$("#cx"+times).html(image);
										}
										
									}
							var changeClass="";
							/**************处理状态 ****************/
							if(type=="text"&&nowInfo.indexOf(feature)!=-1){
								if(times%pagnum>5){
									changeClass="mt1";
								}
								times+=1;var value="";
								var infoArray=statusInfo[feature];//获取对应的 数组对照信息
								var statusValue=info[feature];//获取当前传入状态值 
								//debugger; 
							//	console.log(infoArray);
							    var imgName=null;
								for(var i=0;i<infoArray.length;i++){
									var v=infoArray[i];
									if(v.key==statusValue){
										value=v.value;
										imgName=v.img;
										break;
									}
								}
								var charts=
									//"<div id='cx"+times+"'  class='jtState "+changeClass+"'>"+
										"<p class='stateTxt'>"+title+"</p>"+
											"<div class='lcsLight myImgBox'>"+
												"<img src='${contextPath}/static/phm/images/status/"+imgName+"' alt='图片' />"+
											"</div>"+
											"<p class='txtInfo'>当前状态:<span>"+value+"</span></p>";
										
									//"</div>";
									if(imgName != null){
										$("#cx"+times).html(charts);}
								//debugger;
								continue;
							}else if(!max&&max!="0"){
								type="text";
								label="最大值数据缺失";
							}else if(!min&&min!="0"){
								type="text";
								label="最小值数据缺失";
							}else if(!actualStatus&&actualStatus!="0"){
								type="text";
								label="实际值数据缺失";
							}
						
							if(times%pagnum>5){
								changeClass="mt1";
							}
							if(type=="thermometer"){
								times+=1;
								charts+=
								//"<div id='cx"+times+"' class='jtState "+changeClass+"'>"+
									"<p class='stateTxt'>"+title+"</p>"+
									"<div class='myState'></div>"+
									"<div class='track'>"+
										"<div class='liquid liquid"+times+"'></div>"+
									"</div>"+
									"<div class='max'>"+max+"</div>"+
								    "<div class='mid'></div>"+
								    "<div class='min'>"+min+"</div>"+
								    "<div class='tempTxt'>"+actualStatus+"</div>";
								//"</div>";
								var myarr=new Array();
								
								$("#cx"+times).html(charts);
								
							
								 myarr[0]=["liquid"+times,max,min,actualStatus,"℃"];
								 Status.liquidMove(myarr);
							}if(type=="speedometer"){
								//debugger;
								times+=1;
								charts+=
									//"<div id='cx"+times+"' class='jtState "+changeClass+"'>"+
										"<p class='stateTxt'>"+title+"</p>"+
										"<div class='canvBox'>"+
											"<div id='zsCanvas"+times+"' style='width:100%;height:100%'></div>"+
										"</div>";
									//"</div>";
						//	var option=optionArray[times].zsOption;
							//console.log(optionArray);
						//	 option.series[0].data[0].value =(Math.random()*10).toFixed(2);
							 var zs =optionArray[times];
							// zs.setOption(option, true);
							//	$("#cx"+times).html(charts);
							//actualStatus=(Math.random()*10).toFixed(2);
								speedometer(zs,actualStatus,times,max,min,title,label);
							}else if(type=="gauge"){
								times+=1;
								charts+=
									//"<div id='cx"+times+"' class='jtState "+changeClass+"'>"+
										"<p class='stateTxt'>"+title+"</p>"+
										"<div class='canvBox'>"+
											"<div id='Canvas"+times+"' style='width:100%;height:100%'></div>"+
										"</div>";
									
									//"</div>";
							
							//	$("#cx"+times).html(charts);
							 var zs =optionArray[times];
							// actualStatus=(Math.random()*10).toFixed(2);
								var percent=(actualStatus-min)/(max-min);
								gauge(zs,actualStatus,times,max,min,title,label,percent);
								
							}else if(type=="text"){
								
								times+=1;
								charts+=
									//"<div id='cx"+times+"' class='jtState "+changeClass+"'>"+
										"<p style='margin-left:17%;' class='stateTxt'>"+title+"</p>"+
										
									    "<div style='margin-top: 14%;'><span style='margin:27% 16%;display:block;'>"+(label==undefined?"暂无数据":label)+"</span></div>";
									//"</div>";
						
								$("#cx"+times).html(charts);
							}
						}
						
						
					/*****************************************************************************************************/	
						
				},
			//	error:function(){alert("实时加载错误");}
			
			});
			//debugger;
			
		}
			/********************下面是实时状态分页处理 **********************************/
			var pageNo=1;//记录第几页
			var dataLength=0;//传入数据有多少
			var pagnum=12;//每页多少个
			var idFlage=pagnum;//防止实时状态id唯一
			function pageRight(){
				var p=pageNo*pagnum;
				var l=dataLength+1;//由于加了一张开关门图片
				if(p>=l){
					return;
				}
				pageNo+=1;
				$("#firstPage").html("");
				timeStatus();
			}
			
			function pageLeft(){
				pageNo=pageNo-1;
				if(pageNo<1){
					pageNo=1;
					return;
				}
				$("#firstPage").html("");
				timeStatus();
			}
			function timeStatusChange(){
				 showPageBtn();
				 pageNo=1;//记录第几页
				 $("#firstPage").html("");
				 timeStatus();
			}
			//显示下一页按钮
			function showPageBtn(){
				$("#pageLeft").css("visibility","visible");
				$("#pageRight").css("visibility","visible");
			}
			function hidePageBtn(){
				//$("#pageLeft").css("visibility","hidden");
				//$("#pageRight").css("visibility","hidden");
			}
			/**************************定义 接口数据对照关系 *********************************************************/
			var nowInfo=["M1","M2","S1","S2","S3","S4","S5","S6","S7","S8","S9","S10","S11","S12","S13"];
			var statusInfo={
					  "M1": [
						    {
						      "key": "-1",
						      "value": "正常模式",
						      "img":"gzms.png"
						    },
						    {
						      "key": "00000000",
						      "value": "工作模式",
						      "img":"gzms.png"
						    },
						    {
						      "key": "00010000",
						      "value": "预测测试模式",
						      "img":"gzms.png"
						    },
						    {
						      "key": "00020000",
						      "value": "诊断测试模式",
						      "img":"gzms.png"
						    },
						    {
						      "key": "0003",
						      "value": "假日模式",
						      "img":"gzms.png"
						    }
						  ],
						  "S1": [//冷藏风机
						    {
						      "key": "0000",
						      "value": "停止",
						      "img":"fj_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "启动",
						      "img":"fj_open.png"
						    }
						  ],
						  "S2": [
						    {
						      "key": "0000",
						      "value": "冷藏风门A关",
						      "img":"fma_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "冷藏风门A开",
						      "img":"fma_open.png"
						    },
						    {
						      "key": "0002",
						      "value": "冷藏风门A关",
						      "img":"fma_close.png"
						    },
						    {
						      "key": "0004",
						      "value": "冷藏风门A开",
						      "img":"fma_open.png"
						      
						    }
						  ],
						  "S3": [
						    {
						      "key": "0000",
						      "value": "冷藏风门B关",
						      "img":"fmb_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "冷藏风门B开",
						      "img":"fmb_open.png"
						    },
						    {
						      "key": "0002",
						      "value": "冷藏风门B关",
						      "img":"fmb_close.png"
						    },
						    {
						      "key": "0004",
						      "value": "冷藏风门B开",
						      "img":"fmb_open.png"
						    }
						  ],
						  "S4": [//冷藏除霜
						    {
						      "key": "0000",
						      "value": "停止",
						      "img":"cx_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "启动",
						      "img":"cx_open.png"
						    }
						  ],
						  "S5": [//S5冷冻风机
						    {
						      "key": "0000",
						      "value": "停止",
						      "img":"fj_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "启动",
						      "img":"fj_open.png"
						    }
						  ],
						  "S6": [//冷冻除霜
						    {
						      "key": "0000",
						      "value": "停止",
						      "img":"cx_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "启动",
						      "img":"cx_open.png"
						    }
						  ],
						  "S7": [//冷藏电磁阀
						    {
						      "key": "0000",
						      "value": "关闭",
						      "img":"dcf_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "开启",
						      "img":"dcf_open.png"
						    }
						  ],
						  "S8": [//冷冻电磁阀
						    {
						      "key": "0000",
						      "value": "关闭",
						      "img":"dcf_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "开启",
						      "img":"dcf_open.png"
						    }
						  ],
						  "S9": [//S9竖梁加热丝
						    {
						      "key": "0000",
						      "value": "关闭",
						      "img":"jrs_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "开启",
						      "img":"jrs_open.png"
						    }
						  ],
						  "S10": [//珍品加热丝状
						    {
						      "key": "0000",
						      "value": "关闭",
						      "img":"jrs_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "开启",
						      "img":"jrs_open.png"
						    }
						  ],
						  "S11": [//冷藏室灯状态
						    {
						      "key": "0000",
						      "value": "关闭",
						      "img":"lcsd_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "开启",
						      "img":"lcsd_open.png"
						    }
						  ],
						  "S12": [//UV模块
						    {
						      "key": "0000",
						      "value": "关闭",
						      "img":"uv_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "开启",
						      "img":"uv_open.png"
						    }
						  ],
						  "S13": [//臭氧模块
						    {
						      "key": "0000",
						      "value": "关闭",
						      "img":"cy_close.png"
						    },
						    {
						      "key": "0001",
						      "value": "开启",
						      "img":"cy_open.png"
						    }
						  ],
						  "M2": [
						    {
						      "key": "-1",
						      "value": "正常模式",
						      "img":"gzms.png"
						    },
						    {
						      "key": "0",
						      "value": "工作模式",
						      "img":"gzms.png"
						    },
						    {
						      "key": "3",
						      "value": "假日模式",
						      "img":"gzms.png"
						    }
						  ]
						}
			
			
			

			/* 名称		传感器编号		数据库代号		控制命令字
			T1		冷藏室温度		T1			6DAA
			T2		冷藏变温温度		T2
			T3		冷藏急冷温度		T3
			T4		冷冻温度		T4
			T5		冷藏化霜温度		T5
			T6		冷冻化霜温度		T6
			T7		竖梁温度		T7
			W1		湿度			W1
			T8		冷藏蒸发器入口温度	T8
			T9              冷冻蒸发器入口温度       T9
			T10		压缩机出口温度		T10
			U1		整机输入电压		U1
			I1		整机输入电流		I1
			I2		变频板输入电流		I2

			M1		工作模式		M1			02
			S1		冷藏风机状态		S1			03
			S2		冷藏风门A状态		S2			04
			S3		冷藏风门B状态		S3			05
			S4		冷藏除霜状态		S4			06
			S5		冷冻风机状态		S5			07
			S6		冷冻除霜状态		S6			08
			S7		冷藏电磁阀状态		S7			09
			S8		冷冻电磁阀状态		S8			0A
			V1		压缩机运转频率		V1			0B
			S9		竖梁加热丝状态		S9			0C
			S10		珍品加热丝状态		S10			0D
			S11		冷藏室灯状态		S11			0E
			S12		UV模块工作状态		S12			10
			S13		臭氧模块工作状态	S13			11


			S14		冷藏室左门状态		S14			12  13
			S15		冷藏室右门状态		S15			14  15
			S16		冷冻室上门状态		S16			16  17
			S17		冷冻室下门状态		S17			18  19
			V2		冷藏室温度设定值	V2			1A
			V3		变温室功能设定值	V3			1B
			V4		珍品功能设定值		V4 			1C
			V5		冷冻室温度设定值	V5			1D
			M2		运行模式设定值		M2			1E
			E1		解锁按钮按键释放事件	E1			20


					
 */
		</script>
	</body>
</html>
