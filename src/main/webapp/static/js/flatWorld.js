var allData = {"citys":[
    {"name":"奥尔巴尼","value":[-73.47,42.4,10]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"青岛","value":[120.22,36.04,10]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"北京","value":[116.23,39.55,10]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"贝鲁特","value":[35.3,33.52,10]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"贝尔法斯特","value":[-5.57,54.36,10]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"贝尔格莱德","value":[20.28,44.49,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"贝尔莫潘","value":[-88.46,17.25,32]/*,"symbolSize":3,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"柏林","value":[13.2,52.31,10]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"伯尔尼","value":[7.26,46.57,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"伯利恒","value":[35.12,31.42,2]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"布巴内斯","value":[85.5,20.15,3]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"比林斯","value":[-108.27,45.47,2]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"伯明翰","value":[-1.55,52.3,9]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"伯明翰","value":[-86.55,33.3,-19]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#58B3CC"}}*/},
    {"name":"比什凯克","value":[74.46,42.53,14]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"俾斯麦酒","value":[-100.47,46.49,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"比绍","value":[-15.39,11.52,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"勃朗峰萨伯隆","value":[-57.08,51.26,-364]/*,"symbolSize":14,"itemStyle":{"normal":{"color":"#58B3CC"}}*/},
    {"name":"波哥大","value":[-74.05,4.38,-2]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#58B3CC"}}*/},
    {"name":"博伊西","value":[-116.13,43.37,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"大阪","value":[135.3,34.4,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"东京","value":[139.44,35.41,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"堪察加","value":[158.39,53.01,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"福冈","value":[130.21,33.39,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"荷伯特","value":[147.18,-42.54,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"霍尼亚拉","value":[160.12,-9.32,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"悉尼","value":[151.17,-33.55,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"堪培拉","value":[149.08,-35.18,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"巴西利亚","value":[-47.57,-15.45,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"里约热内卢","value":[-43.15,-22.54,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"开普敦","value":[18.27,-33.55,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"喀山","value":[49.08,55.45,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/},
    {"name":"波士顿","value":[-71.05,42.19,1]/*,"symbolSize":2,"itemStyle":{"normal":{"color":"#F58158"}}*/}],


    "moveLines":[{"fromName":"奥尔巴尼","toName":"北京","coords":[[-73.47,42.4],[116.23,39.55]]},
        {"fromName":"青岛","toName":"北京","coords":[[120.22,36.04],[116.23,39.55]]},
        {"fromName":"贝鲁特","toName":"北京","coords":[[35.3,33.52],[116.23,39.55]]},
        {"fromName":"贝尔法斯特","toName":"北京","coords":[[-5.57,54.36],[116.23,39.55]]},
        {"fromName":"贝尔格莱德","toName":"北京","coords":[[20.28,44.49],[116.23,39.55]]},
        {"fromName":"贝尔莫潘","toName":"北京","coords":[[-88.46,17.25],[116.23,39.55]]},
        {"fromName":"柏林","toName":"北京","coords":[[13.2,52.31],[116.23,39.55]]},
        {"fromName":"伯尔尼","toName":"北京","coords":[[7.26,46.57],[116.23,39.55]]},
        {"fromName":"伯利恒","toName":"北京","coords":[[35.12,31.42],[116.23,39.55]]},
        {"fromName":"布巴内斯","toName":"北京","coords":[[85.5,20.15],[116.23,39.55]]},
        {"fromName":"比林斯","toName":"北京","coords":[[-108.27,45.47],[116.23,39.55]]},
        {"fromName":"伯明翰","toName":"北京","coords":[[-1.55,52.3],[116.23,39.55]]},
        {"fromName":"比什凯克","toName":"北京","coords":[[74.46,42.53],[116.23,39.55]]},
        {"fromName":"俾斯麦酒","toName":"北京","coords":[[-100.47,46.49],[116.23,39.55]]},
        {"fromName":"比绍","toName":"北京","coords":[[-15.39,11.52],[116.23,39.55]]},
        {"fromName":"勃朗峰萨伯隆","toName":"北京","coords":[[-57.08,51.26],[116.23,39.55]]},
        {"fromName":"波哥大","toName":"北京","coords":[[-74.05,4.38],[116.23,39.55]]},
        {"fromName":"博伊西","toName":"北京","coords":[[-116.13,43.37],[116.23,39.55]]},
        {"fromName":"波士顿","toName":"北京","coords":[[-71.05,42.19],[116.23,39.55]]},
        {"fromName":"波士顿","toName":"青岛","coords":[[-71.05,42.19],[120.22,36.04]]},
        {"fromName":"勃朗峰萨伯隆","toName":"青岛","coords":[[-57.08,51.26],[120.22,36.04]]},
        {"fromName":"伯明翰","toName":"青岛","coords":[[-1.55,52.3],[120.22,36.04]]},
        {"fromName":"比林斯","toName":"青岛","coords":[[-108.27,45.47],[120.22,36.04]]},
        {"fromName":"伯尔尼","toName":"青岛","coords":[[7.26,46.57],[120.22,36.04]]},
        {"fromName":"布巴内斯","toName":"青岛","coords":[[85.5,20.15],[120.22,36.04]]},
        {"fromName":"贝鲁特","toName":"青岛","coords":[[35.3,33.52],[120.22,36.04]]},
        {"fromName":"奥尔巴尼","toName":"青岛","coords":[[-73.47,42.4],[120.22,36.04]]},
        {"fromName":"贝尔格莱德","toName":"青岛","coords":[[20.28,44.49],[120.22,36.04]]},
        {"fromName":"贝尔莫潘","toName":"青岛","coords":[[-88.46,17.25],[120.22,36.04]]},
        {"fromName":"大阪","toName":"青岛","coords":[[135.3,34.4],[120.22,36.04]]},
        {"fromName":"东京","toName":"青岛","coords":[[139.44,35.41],[120.22,36.04]]},
        {"fromName":"堪察加","toName":"青岛","coords":[[158.39,53.01],[120.22,36.04]]},
        {"fromName":"福冈","toName":"青岛","coords":[[130.21,33.39],[120.22,36.04]]},
        {"fromName":"荷伯特","toName":"青岛","coords":[[147.18,-42.54],[120.22,36.04]]},
        {"fromName":"霍尼亚拉","toName":"青岛","coords":[[160.12,-9.32],[120.22,36.04]]},
        {"fromName":"堪培拉","toName":"青岛","coords":[[149.08,-35.18],[120.22,36.04]]},
        {"fromName":"悉尼","toName":"青岛","coords":[[151.17,-33.55],[120.22,36.04]]},
        {"fromName":"巴西利亚","toName":"青岛","coords":[[-47.57,-15.45],[120.22,36.04]]},
        {"fromName":"里约热内卢","toName":"青岛","coords":[[-43.15,-22.54],[120.22,36.04]]},
        {"fromName":"开普敦","toName":"青岛","coords":[[18.27,-33.55],[120.22,36.04]]},
        {"fromName":"喀山","toName":"青岛","coords":[[49.08,55.45],[120.22,36.04]]},
        {"fromName":"柏林","toName":"青岛","coords":[[13.2,52.31],[120.22,36.04]]}]};

//初始化加载地图
$(function(){

    $.ajax({
        type:"get",
        url:"/YIJIAN/map/newsRoll",
        data:{},
        dataType:"json",
        success:function (result) {
            console.log(result);
            var str = '<table class="an_right_table">'
            for(var i= 0;i<result.length;i++){
                str+=
                '<tr>'+
                '<td>'+result[i].time.substr(5,16)+'</td>'+
                '<td><a href="/YIJIAN/information/reportdetail?id='+result[i].id+'" target="_blank">'+(result[i].title.length>6?(result[i].title.substr(0,6)+"..."):result[i].title)+
                '</a></td>'+
                '</tr>'
            }
            str+='</table>';
            $("#slide1").html("").append($(str));
            getRoll();
        }
    })
    getAjax(-1);
    var timer = ""
    timer = setInterval(function () {
        var myDate = new Date();
        var hour = myDate.getHours() < 10 ? "0" + myDate.getHours() : myDate.getHours();
        var min = myDate.getMinutes() < 10 ? "0" + myDate.getMinutes() : myDate.getMinutes();
        var sec = myDate.getSeconds() < 10 ? "0" + myDate.getSeconds() : myDate.getSeconds();
        var time = (hour + ":" + min + ":" + sec);
        $(".nav-list .localTime ul span").html(time);
    }, 1000);
    var worldMapChart = echarts.init(document.getElementById('world_map'), 'walden');
/*
    $(".main .nav-list").on("click",function(){
        var dataId = $(".main .nav-list .active").attr("dataId");
        console.log(dataId);
        clearInterval(clearTime);
        worldMapChart.clear();
        getAjax(dataId);
    })
*/getAjax();
    function getAjax(){
        $.ajax({
            type:"get",
            // url:"/YIJIAN/map/newsreports?navigation="+data,
            url:"/YIJIAN/map/newsreports?navigation=",
            data:{},
            dataType:"json",
            success:function (result){
                console.log(result);
                var citys = result.citys;
                var moveLines = result.moveLines;
                worldMapChart.setOption(getWorldMap(citys,moveLines));
                clearTime = setInterval(function() {
                    var i = Math.ceil(Math.random()*(citys.length))-1;
                    console.log(i);
                    if(i>-1){
                        worldMapChart.dispatchAction({
                            type:'showTip',
                            seriesIndex:i,
                            name:citys[i].name
                        });
                    }
                }, 6000);
            }
        })
    }
    guanzhu();
    dingshiRoll();
//使用echarts插件在世界地图添加数据
function getWorldMap(citys,moveLines){

    option = {
        backgroundColor:"black",
        tooltip : {
            trigger: 'item',
            enterable:true,
            hideDelay:2000,
            confine:true,
            borderColor:'gray',
            borderWidth:1,
            textStyle:{
                fontSize:10
            },
            formatter:function(params){
                console.log(params);
                return '<a href="/YIJIAN/information/reportdetail?id='+params.value[2]+'" target="_blank">'
                    +(params.value[7].length>30?(params.value[7].substr(0,30)+"..."):params.value[7])+'</a><br/>&nbsp&nbsp'+params.name
                    +'&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'+params.value[4];
            }
        },
        title: {
            text: '',
            left: 'center',
            textStyle: {
                color: '#fff'
            }
        },
        grid:{
          left:"10%",
            right:"30%",
            width:"60%"
        },
        legend: {
            show: false,
            orient: 'vertical',
            top: 'bottom',
            left: 'right',
            data: ['地点', '线路'],
            textStyle: {
                color: '#fff'
            }
        },
        geo: {
            map: 'world',
            top:"10%",
            button:"15%",
            height:'75%',
            left:"10%",
            right:"20%",
            width:"70%",
            label: {
                emphasis: {
                    show: false
                }
            },
            roam: 'move',
            itemStyle: {
                normal: {
                    areaColor: 'rgba(128, 128, 128, 0)',
                    borderColor:"#49FEFE",
                    borderWidth:0.8,
                    opacity:0.4

                },
                emphasis: {
                    areaColor: 'rgba(128, 128, 128, 0)',
                    borderColor:"#339091",
                    borderWidth:0.8,
                    opacity:0.8
                }
            }
        },
        series:[]
    }
    for(var i= 0;i<citys.length;i++){
        var testArr = [];
        testArr.push(citys[i])
        if(citys[i].name!="青岛"){
        option.series.push(
            {
                name: '地点',
                type: 'effectScatter',
                coordinateSystem: 'geo',
                zlevel: 2,

                symbolSize: function (val) {
                    console.log(val);
                    return (parseInt(val[6])+1000)/250;
                },
                showEffectOn: 'render',
                rippleEffect: {
                    brushType: 'stroke',
                    period: 6,
                    scale: 5
                },
                hoverAnimation: true,
                label: {
                    normal: {
                        formatter: '{b}',
                        position: 'right'
                    }
                },
                itemStyle: {
                    normal: {
                        color: "orange",
                        shadowBlur: 10,
                        shadowColor: '#333'
                    }
                },
                data:testArr
            }
        )
        }else{
            option.series.push(
                {
                    name: '地点',
                    type: 'effectScatter',
                    coordinateSystem: 'geo',
                    zlevel: 2,

                    symbolSize: function (val) {
                        return 15;
                    },
                    showEffectOn: 'render',
                    rippleEffect: {
                        brushType: 'stroke',
                        period: 6,
                        scale: 5
                    },
                    hoverAnimation: true,
                    label: {
                        normal: {
                            formatter: '{b}',
                            position: 'right'
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: "green",
                            shadowBlur: 10,
                            shadowColor: '#333'
                        }
                    },
                    data:testArr
                }
            )
        }
    }
    for(var i= 0;i<moveLines.length;i++){
        var arr = [];
        arr.push(moveLines[i]);
        option.series.push(
            {
                name: '',
                type: 'lines',
                coordinateSystem: 'geo',
                zlevel: 2,
                large: true,
                silent:true,
                effect: {
                    show: true,
                    color: "white",
                    constantSpeed: 80,
                    symbol: 'circle',
                    symbolSize: 3,
                    trailLength: 0.2
                },
                lineStyle: {
                    normal: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0, color: 'orange'
                        }, {
                            offset: 1, color: 'pink'
                        }], false),
                        width: 0.5,
                        opacity: 0.1,
                        curveness: 0.3
                    }
                },
                data:arr
            }
        )
    }
    return option;
}
    scrollbarCusorColor = '#232d39';
    scrollbarBackground = '#0f161c';
    scrollbarCusorWidth = '5';
    scrollbarCursorBorderRadius = '0px';
        $(window).on('load', resize);
        $(window).on('resize', resize);
        $(".slidebar .tab-content").niceScroll({styler:"fb",cursorcolor:scrollbarCusorColor, cursorwidth: scrollbarCusorWidth, cursorborderradius: scrollbarCursorBorderRadius, background: scrollbarBackground, spacebarenabled:false, cursorborder: '', zindex: '1000'});
        $(".nav-list li").click(function(){
            $(".nav-list li").removeClass("active");
            $(this).addClass("active");
        });
    // 窗口大小重新调整
    function resize(){
        var minHeight = $(window).height();
        var maxHeight = window.screen.height;
        var headerHeight = $("header").height();
        var footerHeight =  $("footer").height();
        $(".main").css("height", minHeight - headerHeight - footerHeight);
        $(".slidebar").css("height",minHeight - headerHeight - footerHeight);
        $(".slidebar .tab-content").css("height",$(".slidebar").height() - $(".slide-tab").height());
        worldMapChart.resize();
    }
})
function getDateBase(){
    return 500000000+Math.ceil(Math.random()*20000000);
}
//定时刷新数据
function dingshiRoll() {
    var dataBase = getDateBase();
    var allData = dataBase;
    var CHINA = parseInt(0.8*dataBase);
    var USA = parseInt(0.065*dataBase);
    var GERMANY = parseInt(0.055*dataBase);
    var RUSSIA = parseInt(0.04*dataBase);
    var OTHER = parseInt(0.04*dataBase);
    var zhineng = parseInt(0.2*dataBase);
    var jiqiren = parseInt(0.13*dataBase);
    var hangkong = parseInt(0.07*dataBase);
    var xincailiao = parseInt(0.05*dataBase);
    var rengong = parseInt(0.20*dataBase);
    var dayin = parseInt(0.05*dataBase);
    var xuni = parseInt(0.07*dataBase);
    var yunjisuan = parseInt(0.25*dataBase);
    $("#all_data").html(comdify(allData.toString()));
    $("#china").html(comdify(CHINA.toString()));
    $("#usa").html(comdify(USA.toString()));
    $("#germany").html(comdify(GERMANY.toString()));
    $("#russia").html(comdify(RUSSIA.toString()));
    $("#zhineng").html(comdify(zhineng.toString()));
    $("#jiqiren").html(comdify(jiqiren.toString()));
    $("#hangkong").html(comdify(hangkong.toString()));
    $("#xincailiao").html(comdify(xincailiao.toString()));
    $("#rengong").html(comdify(rengong.toString()));
    $("#dayin").html(comdify(dayin.toString()));
    $("#xuni").html(comdify(xuni.toString()));
    $("#yunjisuan").html(comdify(yunjisuan.toString()));
    setInterval(function() {
        if(allData>600000000){
            dingshiRoll();
        }
        allData += (200+Math.ceil(Math.random()*100));
        CHINA = parseInt(0.8*allData);
        USA = parseInt(0.065*allData);
        GERMANY = parseInt(0.055*allData);
        RUSSIA = parseInt(0.04*allData);
        OTHER = parseInt(0.04*allData);
        zhineng = parseInt(0.2*allData);
        jiqiren = parseInt(0.13*allData);
        hangkong = parseInt(0.07*allData);
        xincailiao = parseInt(0.05*allData);
        rengong = parseInt(0.20*allData);
        dayin = parseInt(0.05*allData);
        xuni = parseInt(0.07*allData);
        yunjisuan = parseInt(0.25*allData);
        $("#all_data").html(comdify(allData.toString()));
        $("#china").html(comdify(CHINA.toString()));
        $("#usa").html(comdify(USA.toString()));
        $("#germany").html(comdify(GERMANY.toString()));
        $("#russia").html(comdify(RUSSIA.toString()));
        $("#zhineng").html(comdify(zhineng.toString()));
        $("#jiqiren").html(comdify(jiqiren.toString()));
        $("#hangkong").html(comdify(hangkong.toString()));
        $("#xincailiao").html(comdify(xincailiao.toString()));
        $("#rengong").html(comdify(rengong.toString()));
        $("#dayin").html(comdify(dayin.toString()));
        $("#xuni").html(comdify(xuni.toString()));
        $("#yunjisuan").html(comdify(yunjisuan.toString()));
    }, 2000);
}
//将字符串格式的整数增加千分位符号“，”
function comdify(num){
    for (var i = 0; i < Math.floor((num.length-(1+i))/3); i++)
    {
        num = num.substring(0,num.length-(4*i+3))+','+num.substring(num.length-(4*i+3));
    }
    return num;
}
function getRoll(){
    var speed=10
    var slide=document.getElementById("slide");
    var slide2=document.getElementById("slide2");
    var slide1=document.getElementById("slide1");
    slide2.innerHTML=slide1.innerHTML
    function Marquee(){
        if(slide2.offsetTop<=slide.scrollTop){
            slide.scrollTop-=slide1.offsetHeight
        }else{
            slide.scrollTop++;
        }
    }
    var MyMar=setInterval(Marquee,speed)
    slide.onmouseover=function(){clearInterval(MyMar)}
    slide.onmouseout=function(){MyMar=setInterval(Marquee,speed)}
}
function guanzhu() {;
    var G_CHINA = 80+Math.ceil(Math.random()*20);
    var G_USA = 60+Math.ceil(Math.random()*20);
    var G_GERMANY = 50+Math.ceil(Math.random()*10);
    var G_RUSSIA = 30+Math.ceil(Math.random()*10);
    var G_JAPAN = 10+Math.ceil(Math.random()*10);
    var G_ENGLAND = 30+Math.ceil(Math.random()*10);
    var G_FRANCE = 10+Math.ceil(Math.random()*10);
    $("#gchina").html(G_CHINA.toString());
    $("#gusa").html(G_USA.toString());
    $("#ggermany").html(G_GERMANY.toString());
    $("#grussia").html(G_RUSSIA.toString());
    $("#gjapan").html(G_JAPAN.toString());
    $("#gengland").html(G_ENGLAND.toString());
    $("#gfrance").html(G_FRANCE.toString());
    setInterval(function() {
        G_CHINA = G_CHINA<100?G_CHINA+Math.ceil(Math.random()*1):80;
        G_USA = G_USA<80?G_USA+Math.ceil(Math.random()*1):60;
        G_GERMANY = G_GERMANY<60?G_GERMANY+Math.ceil(Math.random()*1):50;
        G_RUSSIA = G_RUSSIA<40?G_RUSSIA+Math.ceil(Math.random()*1):30;
        G_JAPAN = G_JAPAN<20?G_JAPAN+Math.ceil(Math.random()*1):10;
        G_ENGLAND = G_ENGLAND<40?G_ENGLAND+Math.ceil(Math.random()*1):30;
        G_FRANCE = G_FRANCE<20?G_FRANCE+Math.ceil(Math.random()*1):10;

        $("#gchina").html(G_CHINA.toString());
        $("#gusa").html(G_USA.toString());
        $("#ggermany").html(G_GERMANY.toString());
        $("#grussia").html(G_RUSSIA.toString());
        $("#gjapan").html(G_JAPAN.toString());
        $("#gengland").html(G_ENGLAND.toString());
        $("#gfrance").html(G_FRANCE.toString());
    }, 10000);
}